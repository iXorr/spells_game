<script setup>
  import { ref, onMounted } from 'vue'
  import { DiamondIcon, BombIcon } from '@shared/icons'

  const baseClasses = ref('falling-block')
  const animationClasses = ref(Math.random() > 0.5 
    ? 'fall-animation' 
    : 'fall-animation-reversed')

  function loot() {
    baseClasses.value += ' falling-block--looted'
  }

  const randomDelay = Math.ceil(Math.random()*5000)
  const randomX = Math.ceil(Math.random()*90)

  const isMounted = ref(false)

  onMounted(() => {
    setTimeout(() => {
      isMounted.value = true;
    }, randomDelay);
  });

  const isDiamond = Math.random() > 0.2
</script>

<template>
  <div
    v-if="isMounted"
    @mousedown="loot"
    @touchstart="loot"
    :class="baseClasses + ' ' + animationClasses"
    :style="{ left: randomX + '%' }">

    <DiamondIcon v-if="isDiamond" />
    <BombIcon v-else />
  </div>
</template>

<style scoped>
  .falling-block {
    position: absolute;
    width: 3rem;
    height: 3rem;
    padding: .5rem;
    filter: drop-shadow(.25rem .25rem .5rem #00000040);
    will-change: contents;
    transition: 
      scale var(--fast-transition), 
      opacity var(--slow-transition);
  }

  .fall-animation {
    animation: 
      spinning 1.5s linear infinite, 
      falling 2.5s ease 1 forwards;
  }

  .fall-animation-reversed {
    animation: 
      spinning 1.5s linear infinite reverse, 
      falling 2.5s ease 1 forwards;
  }

  .falling-block:active {
    cursor: grabbing;
    scale: 1.25;
  }

  .falling-block--looted {
    animation-play-state: paused;
    opacity: 0;
  }

  @keyframes spinning {
    from {
      transform: rotate(0);
    }

    to { 
      transform: rotate(360deg);
    }
  }

  @keyframes falling {
    from {
      bottom: 100%;
    }

    to {
      bottom: -50%;
    }
  }
</style>